{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}Reports: {{ target_user.name }} ({{ target_user.username }}){% endblock %}

{% block content %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Inter:wght@400;500;600;700&display=swap');
  .report-card { image-rendering: auto; }
  .report-card * { margin: 0; padding: 0; }
</style>

<div style="max-width:1200px; margin:0 auto; padding:24px 0;">

  {# ── Header ── #}
  <div style="margin-bottom:24px;">
    <h1 style="font-size:20px; font-weight:700; color:#111; margin:0 0 4px;">
      Reports for {{ target_user.name }}
    </h1>
    <p style="font-size:13px; color:#888; margin:0;">
      @{{ target_user.username }} &middot; {{ target_user.email }}
    </p>
  </div>

  {# ── Tabs ── #}
  <div style="display:flex; gap:8px; margin-bottom:24px;">
    {% for t_val, t_label in tab_choices %}
    <a href="?type={{ t_val }}{% if t_val != 'weekly' %}&year={{ year }}{% endif %}{% if t_val == 'monthly' %}&month={{ month }}{% endif %}"
       style="padding:10px 20px; border-radius:8px; font-size:13px; font-weight:600; text-decoration:none; transition:all .15s;
       {% if report_type == t_val %}background:#FF5C00; color:#fff;{% else %}background:#f3f4f6; color:#555;{% endif %}">
      {{ t_label }}
    </a>
    {% endfor %}
  </div>

  {# ── Year/Month filter ── #}
  {% if report_type == 'monthly' or report_type == 'yearly' %}
  <form method="get" style="display:flex; align-items:center; gap:12px; margin-bottom:24px; padding:16px; background:#f9fafb; border-radius:10px; border:1px solid #e5e7eb;">
    <input type="hidden" name="type" value="{{ report_type }}">
    <label style="font-size:13px; font-weight:600; color:#555;">Year:</label>
    <select name="year" style="border-radius:6px; border:1px solid #d1d5db; font-size:13px; padding:6px 10px;">
      {% for y in year_choices %}
        <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>
    {% if report_type == 'monthly' %}
    <label style="font-size:13px; font-weight:600; color:#555;">Month:</label>
    <select name="month" style="border-radius:6px; border:1px solid #d1d5db; font-size:13px; padding:6px 10px;">
      {% for m_val, m_name in month_choices %}
        <option value="{{ m_val }}" {% if m_val == month %}selected{% endif %}>{{ m_name }}</option>
      {% endfor %}
    </select>
    {% endif %}
    <button type="submit" style="padding:7px 18px; font-size:13px; font-weight:600; border-radius:6px; background:#FF5C00; color:#fff; border:none; cursor:pointer;">
      Load
    </button>
  </form>
  {% endif %}

  {# ── Empty state ── #}
  {% if report_empty %}
  <div style="padding:64px; text-align:center; background:#f9fafb; border-radius:12px; border:1px solid #e5e7eb;">
    <p style="font-size:16px; color:#888;">{{ empty_message }}</p>
  </div>
  {% elif report %}

  {# ══════════════════════════════════════ #}
  {# REPORT CARD - exact replica of frontend #}
  {# ══════════════════════════════════════ #}
  <div style="display:flex; justify-content:center;">
    <div class="report-card" style="border-radius:16px; overflow:hidden; box-shadow:0 25px 50px -12px rgba(0,0,0,0.5);">

      {# ──── WEEKLY ──── #}
      {% if report_type == 'weekly' %}
      <div style="display:flex; width:1080px; height:1080px; background:linear-gradient(145deg, #0A0A0B 0%, #1A1A1D 100%); font-family:'DM Mono', monospace;">
        {# Left panel - orange #}
        <div style="display:flex; flex-direction:column; justify-content:space-between; flex-shrink:0; width:460px; height:100%; background:linear-gradient(180deg, #FF5C00 0%, #FF7A33 60%, #FFB347 100%); padding:48px; box-sizing:border-box;">
          <div style="display:flex; flex-direction:column; gap:20px;">
            <div style="display:flex; align-items:center; gap:8px; height:20px;">
              <img src="{% static 'img/logo.png' %}" alt="" width="20" height="20" style="display:block;">
              <span style="font-size:13px; font-weight:600; letter-spacing:3px; color:#0A0A0B; line-height:20px;">OPEN</span>
              <span style="font-size:13px; font-weight:700; letter-spacing:3px; color:#0A0A0B; line-height:20px;">PAPERTRADE</span>
            </div>
            <div style="display:inline-block; align-self:flex-start; border-radius:20px; padding:8px 16px; background:#0A0A0B20;">
              <span style="font-size:11px; letter-spacing:2px; color:#0A0A0B; line-height:14px;">{{ report.dateRange }}</span>
            </div>
          </div>
          <div style="display:flex; flex-direction:column; gap:24px;">
            <div style="font-size:72px; font-weight:700; color:#0A0A0B; line-height:66px; letter-spacing:-3px;">Your<br>Weekly<br>Wins.</div>
            <p style="font-size:14px; color:#0A0A0BAA; line-height:22px; max-width:320px; margin:0;">Another week of smart trading decisions and portfolio growth.</p>
          </div>
          <div style="display:flex; flex-direction:column; gap:20px;">
            <div style="display:flex; align-items:center; gap:16px; border-radius:16px; padding:20px; background:#0A0A0B15;">
              <div style="display:flex; align-items:center; justify-content:center; flex-shrink:0; width:64px; height:64px; border-radius:32px; background:#0A0A0B; border:3px solid #0A0A0B30; box-sizing:border-box; overflow:hidden;">
                {% if avatar_url %}
                <img src="{{ avatar_url }}" alt="" width="64" height="64" style="display:block; width:100%; height:100%; object-fit:cover;">
                {% else %}
                <span style="font-size:22px; font-weight:700; color:#FF5C00; line-height:22px;">{{ report.initials }}</span>
                {% endif %}
              </div>
              <div style="display:flex; flex-direction:column; gap:4px; flex:1; min-width:0;">
                <span style="font-size:18px; font-weight:700; color:#0A0A0B; line-height:22px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">@{{ report.username }}</span>
                <span style="font-size:12px; color:#0A0A0B80; font-family:Inter, sans-serif; line-height:16px;">Paper Trader since {{ report.memberSince }}</span>
              </div>
              <div style="display:flex; flex-direction:column; align-items:flex-end; gap:2px;">
                <span style="font-size:14px; font-weight:700; color:#0A0A0B; line-height:18px;">{{ report.rank }}</span>
                <span style="font-size:11px; color:#0A0A0B60; font-family:Inter, sans-serif; line-height:14px;">this week</span>
              </div>
            </div>
            <span style="font-size:12px; letter-spacing:1px; color:#0A0A0B80; line-height:16px;">#OpenPaperTrade</span>
          </div>
        </div>

        {# Right panel - dark #}
        <div style="display:flex; flex-direction:column; gap:24px; flex:1; background:#0A0A0B; padding:48px; box-sizing:border-box;">
          <div style="display:flex; align-items:center; justify-content:space-between; width:100%; height:40px;">
            <span style="font-size:11px; letter-spacing:3px; color:#6B6B70; line-height:40px;">THIS WEEK'S NUMBERS</span>
          </div>
          {# Stats row 1 #}
          <div style="display:flex; gap:16px; width:100%;">
            <div style="display:flex; flex-direction:column; gap:12px; flex:1; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">TOTAL RETURN</span>
              <span style="font-size:32px; font-weight:700; color:{% if report.totalReturnPositive %}#22C55E{% else %}#EF4444{% endif %}; line-height:36px;">{{ report.totalReturn }}</span>
              <div style="display:flex; align-items:center; gap:6px; height:14px;">
                <span style="font-size:11px; color:#6B6B70; font-family:Inter, sans-serif; line-height:14px;">{{ report.returnChange }}</span>
              </div>
            </div>
            <div style="display:flex; flex-direction:column; gap:12px; flex:1; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">WIN RATE</span>
              <span style="font-size:32px; font-weight:700; color:white; line-height:36px;">{{ report.winRate }}%</span>
              <div style="display:flex; align-items:center; gap:6px; height:14px;">
                <span style="color:#8B5CF6; font-size:14px; line-height:14px;">&#x25CE;</span>
                <span style="font-size:11px; color:#6B6B70; font-family:Inter, sans-serif; line-height:14px;">{{ report.winRateDetail }}</span>
              </div>
            </div>
          </div>
          {# Best trade #}
          <div style="display:flex; align-items:center; gap:20px; width:100%; border-radius:12px; padding:24px; background:linear-gradient(135deg, #1A1A1D 0%, #252528 100%); border:1px solid #2A2A2E; box-sizing:border-box;">
            <div style="display:flex; flex-direction:column; gap:6px; flex:1;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">BEST TRADE THIS WEEK</span>
              <span style="font-size:36px; font-weight:700; color:white; line-height:40px;">{{ report.bestTicker }}</span>
              <span style="font-size:12px; color:#6B6B70; font-family:Inter, sans-serif; line-height:16px;">{{ report.bestName }}</span>
            </div>
            <div style="display:flex; flex-direction:column; align-items:flex-end; gap:4px;">
              <span style="font-size:24px; font-weight:700; color:#22C55E; line-height:28px;">{{ report.bestProfit }}</span>
              <span style="font-size:13px; color:#22C55E; font-family:Inter, sans-serif; line-height:16px;">{{ report.bestPercent }}</span>
            </div>
          </div>
          {# Stats row 2 #}
          <div style="display:flex; gap:16px; width:100%;">
            <div style="display:flex; flex-direction:column; gap:8px; flex:1; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">TRADES</span>
              <span style="font-size:28px; font-weight:700; color:#FF5C00; line-height:32px;">{{ report.trades }}</span>
            </div>
            <div style="display:flex; flex-direction:column; gap:8px; flex:1; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">VOLUME</span>
              <span style="font-size:28px; font-weight:700; color:white; line-height:32px;">{{ report.volume }}</span>
            </div>
            <div style="display:flex; flex-direction:column; gap:8px; flex:1; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">STREAK</span>
              <span style="font-size:28px; font-weight:700; color:{% if report.streakPositive %}#22C55E{% else %}white{% endif %}; line-height:32px;">{{ report.streak }}</span>
            </div>
          </div>
          {# Chart #}
          <div style="display:flex; flex-direction:column; gap:16px; flex:1; width:100%; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
            <div style="display:flex; align-items:center; justify-content:space-between; width:100%; height:16px;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:16px;">DAILY PERFORMANCE</span>
              <span style="font-size:13px; font-weight:600; color:#22C55E; line-height:16px;">{{ report.dailyChangePercent }}</span>
            </div>
            <div style="display:flex; align-items:flex-end; gap:8px; flex:1; width:100%;">
              {% for bar in report.dailyBars %}
              <div style="flex:1; height:{{ bar.height }}%; background:{% if bar.value < 0 %}#EF4444{% elif bar.highlight %}#FF5C00{% else %}#2A2A2E{% endif %}; border-radius:4px 4px 0 0;"></div>
              {% endfor %}
            </div>
            <div style="display:flex; justify-content:space-between; width:100%;">
              {% for bar in report.dailyBars %}
              <span style="font-size:10px; color:#4A4A50; line-height:12px;">{{ bar.label }}</span>
              {% endfor %}
            </div>
          </div>
          {# Footer #}
          <div style="display:flex; align-items:center; justify-content:space-between; width:100%; height:14px;">
            <div style="display:flex; align-items:center; gap:6px; height:14px;">
              <img src="{% static 'img/logo.png' %}" alt="" width="14" height="14" style="display:block;">
              <span style="font-size:11px; color:#4A4A50; font-family:Inter, sans-serif; line-height:14px;">Open Papertrade</span>
            </div>
            <span style="font-size:11px; color:#4A4A50; font-family:Inter, sans-serif; line-height:14px;">Generated {{ report.generatedDate }}</span>
          </div>
        </div>
      </div>
      {% endif %}

      {# ──── MONTHLY ──── #}
      {% if report_type == 'monthly' %}
      <div style="display:flex; width:1080px; height:1080px; font-family:'DM Mono', monospace;">
        {# Left panel - orange #}
        <div style="display:flex; flex-direction:column; justify-content:space-between; flex-shrink:0; width:480px; height:100%; background:linear-gradient(160deg, #FF5C00 0%, #FF8A4C 50%, #FFB347 100%); padding:48px; box-sizing:border-box;">
          <div style="display:flex; flex-direction:column; gap:16px;">
            <div style="display:flex; align-items:center; gap:8px; height:20px;">
              <img src="{% static 'img/logo.png' %}" alt="" width="20" height="20" style="display:block;">
              <span style="font-size:14px; font-weight:600; letter-spacing:3px; color:#0A0A0B; line-height:20px;">OPEN</span>
              <span style="font-size:14px; font-weight:700; letter-spacing:3px; color:#0A0A0B; line-height:20px;">PAPERTRADE</span>
            </div>
            <div style="display:inline-block; align-self:flex-start; border-radius:20px; padding:8px 16px; background:#0A0A0B20;">
              <span style="font-size:11px; letter-spacing:3px; color:#0A0A0B; line-height:14px;">{{ report.month|upper }}</span>
            </div>
          </div>
          <div style="display:flex; flex-direction:column; gap:20px;">
            <div style="font-size:72px; font-weight:700; color:#0A0A0B; line-height:68px; letter-spacing:-2px;">Month<br>In<br>Review</div>
            <p style="font-size:14px; color:#0A0A0BAA; line-height:22px; max-width:320px; margin:0;">You crushed it this month with {{ report.totalTrades }} trades across {{ report.uniqueStocks }} different stocks.</p>
          </div>
          <div style="display:flex; align-items:center; gap:12px;">
            {% if avatar_url %}
            <div style="width:40px; height:40px; border-radius:20px; overflow:hidden; flex-shrink:0; border:2px solid #0A0A0B20; box-sizing:border-box;">
              <img src="{{ avatar_url }}" alt="" width="40" height="40" style="display:block; width:100%; height:100%; object-fit:cover;">
            </div>
            {% else %}{% if report.initials %}
            <div style="display:flex; align-items:center; justify-content:center; width:40px; height:40px; border-radius:20px; background:#0A0A0B; flex-shrink:0; border:2px solid #0A0A0B20; box-sizing:border-box;">
              <span style="font-size:14px; font-weight:700; color:#FF5C00;">{{ report.initials }}</span>
            </div>
            {% endif %}{% endif %}
            <div style="display:flex; flex-direction:column; gap:2px;">
              <span style="font-size:18px; font-weight:600; color:#0A0A0B; line-height:22px;">@{{ report.username }}</span>
              <span style="font-size:12px; color:#0A0A0B80; line-height:16px;">Trading since {{ report.memberSince }}</span>
            </div>
          </div>
        </div>

        {# Right panel - dark #}
        <div style="display:flex; flex-direction:column; gap:24px; flex:1; background:#0A0A0B; padding:48px; box-sizing:border-box;">
          <div style="display:flex; align-items:center; justify-content:space-between; width:100%; height:40px;">
            <span style="font-size:11px; letter-spacing:3px; color:#6B6B70; line-height:40px;">YOUR NUMBERS</span>
          </div>
          {# Stats row 1 #}
          <div style="display:flex; gap:16px; width:100%;">
            <div style="display:flex; flex-direction:column; gap:12px; flex:1; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">TOTAL P&amp;L</span>
              <span style="font-size:32px; font-weight:700; color:{% if report.totalPLPositive %}#22C55E{% else %}#EF4444{% endif %}; line-height:36px;">{{ report.totalPL }}</span>
            </div>
            <div style="display:flex; flex-direction:column; gap:12px; flex:1; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">VOLUME</span>
              <span style="font-size:32px; font-weight:700; color:white; line-height:36px;">{{ report.volume }}</span>
            </div>
          </div>
          {# Best performer #}
          <div style="display:flex; align-items:center; gap:24px; width:100%; border-radius:12px; padding:24px; background:linear-gradient(135deg, #1A1A1D 0%, #252528 100%); border:1px solid #2A2A2E; box-sizing:border-box;">
            <div style="display:flex; flex-direction:column; gap:8px; flex:1;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">BEST PERFORMER</span>
              <span style="font-size:40px; font-weight:700; color:white; line-height:44px;">{{ report.bestTicker }}</span>
              <span style="font-size:13px; color:#6B6B70; font-family:Inter, sans-serif; line-height:16px;">{{ report.bestName }}</span>
            </div>
            <div style="display:flex; flex-direction:column; align-items:flex-end; gap:4px;">
              <span style="font-size:24px; font-weight:700; color:#22C55E; line-height:28px;">{{ report.bestProfit }}</span>
              <span style="font-size:14px; color:#22C55E; font-family:Inter, sans-serif; line-height:18px;">{{ report.bestPercent }}</span>
            </div>
          </div>
          {# Stats row 2 #}
          <div style="display:flex; gap:16px; width:100%;">
            <div style="display:flex; flex-direction:column; gap:8px; flex:1; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">WIN RATE</span>
              <span style="font-size:28px; font-weight:700; color:white; line-height:32px;">{{ report.winRate }}%</span>
            </div>
            <div style="display:flex; flex-direction:column; gap:8px; flex:1; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">STREAK</span>
              <span style="font-size:28px; font-weight:700; color:{% if report.streakPositive %}#FF5C00{% else %}white{% endif %}; line-height:32px;">{{ report.streak }}</span>
            </div>
            <div style="display:flex; flex-direction:column; gap:8px; flex:1; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:12px;">STOCKS</span>
              <span style="font-size:28px; font-weight:700; color:white; line-height:32px;">{{ report.stocks }}</span>
            </div>
          </div>
          {# Growth chart #}
          <div style="display:flex; flex-direction:column; gap:20px; flex:1; width:100%; border-radius:12px; background:#111113; padding:24px; border:1px solid #1F1F23; box-sizing:border-box;">
            <div style="display:flex; align-items:center; justify-content:space-between; width:100%; height:16px;">
              <span style="font-size:10px; letter-spacing:2px; color:#6B6B70; line-height:16px;">MONTHLY GROWTH</span>
              <span style="font-size:14px; font-weight:600; color:{% if report.growthPositive %}#22C55E{% else %}#EF4444{% endif %}; line-height:16px;">{{ report.growthPercent }}</span>
            </div>
            <div style="display:flex; align-items:flex-end; gap:6px; flex:1; width:100%;">
              {% for bar in report.weekBars %}
              <div style="flex:1; height:{{ bar.height }}%; background:{% if bar.value < 0 %}#EF4444{% elif bar.highlight %}#FF5C00{% else %}#2A2A2E{% endif %}; border-radius:4px 4px 0 0;"></div>
              {% endfor %}
            </div>
            <div style="display:flex; justify-content:space-between; width:100%;">
              {% for bar in report.weekBars %}
              <span style="font-size:10px; color:#4A4A50; line-height:12px;">{{ bar.label }}</span>
              {% endfor %}
            </div>
          </div>
          {# Footer #}
          <div style="display:flex; align-items:center; justify-content:space-between; width:100%; height:14px;">
            <div style="display:flex; align-items:center; gap:6px; height:14px;">
              <img src="{% static 'img/logo.png' %}" alt="" width="14" height="14" style="display:block;">
              <span style="font-size:12px; color:#6B6B70; font-family:Inter, sans-serif; line-height:14px;">Open Papertrade</span>
            </div>
            <span style="font-size:11px; color:#FF5C00; line-height:14px;">#OpenPaperTrade</span>
          </div>
        </div>
      </div>
      {% endif %}

      {# ──── YEARLY WRAPPED ──── #}
      {% if report_type == 'yearly' %}
      <div style="position:relative; overflow:hidden; width:1080px; height:1415px; background:#0A0A0B; font-family:'DM Mono', monospace;">
        {# Background glows #}
        <div style="position:absolute; width:900px; height:900px; left:-250px; top:-250px; background:radial-gradient(circle, #FF5C0050 0%, #FF5C0000 70%); border-radius:50%; filter:blur(120px);"></div>
        <div style="position:absolute; width:700px; height:700px; left:550px; top:850px; background:radial-gradient(circle, #8B5CF635 0%, #8B5CF600 70%); border-radius:50%; filter:blur(100px);"></div>
        <div style="position:absolute; width:500px; height:500px; left:300px; top:400px; background:radial-gradient(circle, #FF5C0018 0%, #FF5C0000 70%); border-radius:50%; filter:blur(80px);"></div>

        {# Main content #}
        <div style="position:relative; display:flex; flex-direction:column; gap:40px; padding:56px; width:1080px; height:1350px; box-sizing:border-box;">
          {# Top bar #}
          <div style="display:flex; align-items:center; justify-content:space-between; width:100%; height:32px;">
            <div style="display:flex; align-items:center; gap:10px; height:22px;">
              <img src="{% static 'img/logo.png' %}" alt="" width="22" height="22" style="display:block;">
              <span style="font-size:14px; font-weight:700; letter-spacing:4px; color:white; line-height:22px;">OPEN</span>
              <span style="font-size:14px; font-weight:700; letter-spacing:4px; color:#FF5C00; line-height:22px;">PAPERTRADE</span>
            </div>
            <div style="border-radius:24px; padding:10px 20px; background:linear-gradient(90deg, rgba(255,92,0,0.9) 0%, rgba(255,138,76,0.9) 100%); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);">
              <span style="font-size:12px; font-weight:700; letter-spacing:2px; color:white; line-height:14px;">{{ report.year }} WRAPPED</span>
            </div>
          </div>

          {# Profile #}
          <div style="display:flex; align-items:center; gap:32px; width:100%;">
            <div style="display:flex; align-items:center; justify-content:center; flex-shrink:0; width:180px; height:180px; border-radius:90px; background:linear-gradient(135deg, #FF5C00 0%, #FF8A4C 50%, #8B5CF6 100%);">
              <div style="display:flex; align-items:center; justify-content:center; width:168px; height:168px; border-radius:84px; background:rgba(26,26,29,0.85); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); overflow:hidden;">
                {% if avatar_url %}
                <img src="{{ avatar_url }}" alt="" width="168" height="168" style="display:block; width:100%; height:100%; object-fit:cover;">
                {% else %}
                <span style="font-size:56px; font-weight:700; color:white; line-height:56px;">{{ report.initials }}</span>
                {% endif %}
              </div>
            </div>
            <div style="display:flex; flex-direction:column; gap:8px;">
              <span style="font-size:28px; font-weight:700; color:white; line-height:32px;">@{{ report.username }}</span>
              <div style="display:flex; align-items:center; gap:16px; height:18px;">
                <span style="font-size:14px; color:#6B6B70; font-family:Inter, sans-serif; line-height:18px;">Trading since {{ report.memberSince }}</span>
                <div style="width:4px; height:4px; border-radius:2px; background:#3A3A40;"></div>
                <span style="font-size:14px; color:#FF5C00; font-family:Inter, sans-serif; line-height:18px;">{{ report.traderRank }}</span>
              </div>
            </div>
          </div>

          {# Hero text #}
          <div style="display:flex; flex-direction:column; align-items:center; gap:16px; width:100%;">
            <span style="font-size:48px; color:rgba(255,255,255,0.5); line-height:52px;">What a year,</span>
            <span style="font-size:72px; font-weight:700; color:white; letter-spacing:-2px; line-height:76px;">Trader.</span>
          </div>

          {# Stats #}
          <div style="display:flex; flex-direction:column; gap:24px; width:100%; padding-top:32px; padding-bottom:32px;">
            <div style="display:flex; gap:16px; width:100%;">
              <div style="display:flex; flex-direction:column; gap:8px; flex:1; border-radius:20px; padding:28px; background:rgba(26,26,29,0.6); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,0.06); box-sizing:border-box;">
                <span style="font-size:52px; font-weight:700; color:#FF5C00; line-height:56px;">{{ report.totalTrades }}</span>
                <span style="font-size:14px; color:#6B6B70; font-family:Inter, sans-serif; line-height:18px;">Total Trades</span>
              </div>
              <div style="display:flex; flex-direction:column; gap:8px; flex:1; border-radius:20px; padding:28px; background:rgba(26,26,29,0.6); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,0.06); box-sizing:border-box;">
                <span style="font-size:52px; font-weight:700; color:{% if report.totalProfitPositive %}#22C55E{% else %}#EF4444{% endif %}; line-height:56px;">{{ report.totalProfit }}</span>
                <span style="font-size:14px; color:#6B6B70; font-family:Inter, sans-serif; line-height:18px;">Total Profit</span>
              </div>
            </div>
            <div style="display:flex; gap:16px; width:100%;">
              <div style="display:flex; flex-direction:column; gap:8px; flex:1; border-radius:20px; padding:28px; background:rgba(26,26,29,0.6); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,0.06); box-sizing:border-box;">
                <span style="font-size:52px; font-weight:700; color:white; line-height:56px;">{{ report.winRate }}%</span>
                <span style="font-size:14px; color:#6B6B70; font-family:Inter, sans-serif; line-height:18px;">Win Rate</span>
              </div>
              <div style="display:flex; flex-direction:column; gap:8px; flex:1; border-radius:20px; padding:28px; background:rgba(26,26,29,0.6); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,0.06); box-sizing:border-box;">
                <span style="font-size:52px; font-weight:700; color:#8B5CF6; line-height:56px;">{{ report.stocksTraded }}</span>
                <span style="font-size:14px; color:#6B6B70; font-family:Inter, sans-serif; line-height:18px;">Stocks Traded</span>
              </div>
            </div>

            {# Highlight - best performer #}
            <div style="display:flex; align-items:center; gap:24px; width:100%; border-radius:20px; padding:28px; background:linear-gradient(100deg, rgba(255,92,0,0.1) 0%, rgba(139,92,246,0.08) 100%); backdrop-filter:blur(24px); -webkit-backdrop-filter:blur(24px); border:1px solid rgba(255,92,0,0.2); box-sizing:border-box;">
              <div style="display:flex; flex-direction:column; gap:6px; flex:1;">
                <span style="font-size:11px; letter-spacing:3px; color:#FF5C00; line-height:14px;">BEST PERFORMER</span>
                <span style="font-size:40px; font-weight:700; color:white; line-height:44px;">{{ report.bestTicker }}</span>
                <span style="font-size:13px; color:#6B6B70; font-family:Inter, sans-serif; line-height:16px;">{{ report.bestTradeCount }} trades &middot; {{ report.bestProfit }} profit</span>
              </div>
              <div style="display:flex; flex-direction:column; align-items:flex-end; gap:4px;">
                <span style="font-size:32px; font-weight:700; color:#22C55E; line-height:36px;">{{ report.bestReturn }}</span>
                <span style="font-size:12px; color:#6B6B70; font-family:Inter, sans-serif; line-height:16px;">annual return</span>
              </div>
            </div>

            {# Mini stats #}
            <div style="display:flex; gap:12px; width:100%;">
              <div style="display:flex; flex-direction:column; align-items:center; gap:4px; flex:1; border-radius:12px; background:rgba(17,17,19,0.7); backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px); border:1px solid rgba(255,255,255,0.04); padding:16px 20px; box-sizing:border-box;">
                <span style="font-size:24px; font-weight:700; color:white; line-height:28px;">{{ report.dayStreak }}</span>
                <span style="font-size:11px; color:#6B6B70; font-family:Inter, sans-serif; line-height:14px;">Day Streak</span>
              </div>
              <div style="display:flex; flex-direction:column; align-items:center; gap:4px; flex:1; border-radius:12px; background:rgba(17,17,19,0.7); backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px); border:1px solid rgba(255,255,255,0.04); padding:16px 20px; box-sizing:border-box;">
                <span style="font-size:24px; font-weight:700; color:white; line-height:28px;">{{ report.volume }}</span>
                <span style="font-size:11px; color:#6B6B70; font-family:Inter, sans-serif; line-height:14px;">Volume</span>
              </div>
              <div style="display:flex; flex-direction:column; align-items:center; gap:4px; flex:1; border-radius:12px; background:rgba(17,17,19,0.7); backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px); border:1px solid rgba(255,255,255,0.04); padding:16px 20px; box-sizing:border-box;">
                <span style="font-size:24px; font-weight:700; color:#FF5C00; line-height:28px;">{{ report.bestDay }}</span>
                <span style="font-size:11px; color:#6B6B70; font-family:Inter, sans-serif; line-height:14px;">Best Day</span>
              </div>
            </div>
          </div>

          {# Footer #}
          <div style="display:flex; flex-direction:column; align-items:center; gap:20px; width:100%;">
            <div style="display:flex; align-items:center; gap:12px; height:16px;">
              <span style="font-size:13px; color:#FF5C00; line-height:16px;">#OpenPaperTrade</span>
              <div style="width:4px; height:4px; border-radius:2px; background:#3A3A40;"></div>
              <span style="font-size:13px; color:#8B5CF6; line-height:16px;">#{{ report.year }}Wrapped</span>
            </div>
            <div style="display:flex; align-items:center; gap:8px; height:14px;">
              <img src="{% static 'img/logo.png' %}" alt="" width="14" height="14" style="display:block;">
              <span style="font-size:12px; color:#4A4A50; font-family:Inter, sans-serif; line-height:14px;">Open Papertrade</span>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

    </div>
  </div>
  {% endif %}

  {# ── Back link ── #}
  <div style="margin-top:32px;">
    <a href="{% url 'admin:users_userprofile_changelist' %}" style="font-size:13px; color:#FF5C00; text-decoration:none;">
      &larr; Back to user list
    </a>
  </div>
</div>
{% endblock %}
